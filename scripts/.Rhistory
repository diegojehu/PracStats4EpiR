step.table.1 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"")) %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header")
step.table.1 %>%
flextable() %>%
autofit()
step.table.1 %>%
flextable() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_names = "Difference in means (95% CI)",
p.val = "p-value") %>%
autofit() %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header")
step.table.1 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_names = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header")
step.table.1 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header")
step.table.1 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header")
step.table.1 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-1.png")
knitr::opts_chunk$set(echo = TRUE)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(gifski, ggplot2, rio, here, janitor, skimr, forcats, lubridate, tidyverse, gtsummary, rstatix, flextable, gt, webshot)
steps_test_raw <- import(here("data", "STEPS_EpiInfo_Test.xlsx"))
skimr::skim(steps_test_raw)
steps_test <- steps_test_raw %>%
janitor::clean_names() %>%
# New name     # Old name
rename(sex          = c1,
age          = c3,
curr_smkr    = t1,
daily_smkr   = t2,
curr_alc     = a1,
freq_alc     = a2,
bp_last_meas = h1,
height_cm    = m3,
weight_kg    = m4,
sbp_1        = m11a,
sbp_2        = m12a,
sbp_3        = m13a) %>%
mutate(sbp = (sbp_1+sbp_2+sbp_3)/3, # Here I simply calculate the mean of the 3 sbp measurements
sex_fct = factor(sex, labels = c("Men", "Women"))) # Originally coded as 1 and 2
steps_test_lec1 <- steps_test %>%
select(c(sex_fct,sbp,sex)) %>%
drop_na() %>%
add_row(sbp = 540, sex_fct = as.factor("Women")) %>%
add_row(sbp = 538, sex_fct = as.factor("Women")) %>%
add_row(sbp = 542, sex_fct = as.factor("Women")) %>%
add_row(sbp = 540, sex_fct = as.factor("Women")) %>%
add_row(sbp = 538, sex_fct = as.factor("Women")) %>%
add_row(sbp = 542, sex_fct = as.factor("Women")) %>%
add_row(sbp = 540, sex_fct = as.factor("Women")) %>%
add_row(sbp = 538, sex_fct = as.factor("Women")) %>%
add_row(sbp = 542, sex_fct = as.factor("Women")) %>%
add_row(sbp = 540, sex_fct = as.factor("Women"))
steps_test_lec1 <- steps_test %>%
select(c(sex_fct,sbp,sex)) %>%
drop_na() %>%
add_row(sbp = 540, sex_fct = as.factor("Women")) %>%
add_row(sbp = 538, sex_fct = as.factor("Women")) %>%
add_row(sbp = 542, sex_fct = as.factor("Women")) %>%
add_row(sbp = 540, sex_fct = as.factor("Women")) %>%
add_row(sbp = 538, sex_fct = as.factor("Women")) %>%
add_row(sbp = 542, sex_fct = as.factor("Women")) %>%
add_row(sbp = 540, sex_fct = as.factor("Women")) %>%
add_row(sbp = 538, sex_fct = as.factor("Women")) %>%
add_row(sbp = 542, sex_fct = as.factor("Women")) %>%
add_row(sbp = 540, sex_fct = as.factor("Women"))
#Make table, then export as png, adding p values for differences in mean
step.table <- c()
model.names <- c("Before cleaining", "After dropping implausible values", "After dropping outliers")
sd.3 <- mean(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250])) + 3* sd(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250]))
df.list <- list(
steps_test_lec1,
filter(steps_test_lec1, sbp <250),
filter(steps_test_lec1, sbp < sd.3)
)
for (i in 1:length(model.names)){
mod.name <- model.names[i]
mean_men <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T), 1)})")
mean_women <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)})")
diff <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T) - mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)} ({round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[1]}, {round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[2]})")
t_t <- round(t.test(sbp ~ sex_fct, data=df.list[[i]])[[3]], 3)
build.df <- data.frame(
"Model"=mod.name,
"Men"=mean_men,
"Women"=mean_women,
"Diff_in_means"=diff,
"p-val"=t_t)
step.table <- rbind(step.table,build.df)
}
step.table.1 <- step.table[1,]
step.table.2 <- step.table[1:2,]
step.table.3 <- step.table
step.table.1 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-1.png")
step.table.2 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-2.png")
step.table.3 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-3.png")
webshot::install_phantomjs()
webshot::is_phantomjs_installed()
if(webshot::is_phantomjs_installed()==F)webshot::install_phantomjs()
step.table <- c()
model.names <- c("Before cleaining", "After dropping implausible values", "After dropping outliers")
sd.3 <- mean(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250])) + 3* sd(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250]))
df.list <- list(
steps_test_lec1,
filter(steps_test_lec1, sbp <250),
filter(steps_test_lec1, sbp < sd.3)
)
for (i in 1:length(model.names)){
mod.name <- model.names[i]
mean_men <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T), 1)})")
mean_women <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)})")
diff <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T) - mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)} ({round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[1]}, {round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[2]})")
t_t <- round(t.test(sbp ~ sex_fct, data=df.list[[i]])[[3]], 3)
build.df <- data.frame(
"Model"=mod.name,
"Men"=mean_men,
"Women"=mean_women,
"Diff_in_means"=diff,
"p-val"=t_t)
step.table <- rbind(step.table,build.df)
}
step.table.1 <- step.table[1,]
step.table.2 <- step.table[1:2,]
step.table.3 <- step.table
step.table.1 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-1.png")
step.table.2 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-2.png")
step.table.3 %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-3.png")
#Make table, then export as png, adding p values for differences in mean
step.table <- c()
model.names <- c("Before cleaining", "After dropping implausible values", "After dropping outliers")
sd.3 <- mean(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250])) + 3* sd(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250]))
df.list <- list(
steps_test_lec1,
filter(steps_test_lec1, sbp <250),
filter(steps_test_lec1, sbp < sd.3)
)
for (i in 1:length(model.names)){
mod.name <- model.names[i]
mean_men <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T), 1)})")
mean_women <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)})")
diff <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T) - mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)} ({round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[1]}, {round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[2]})")
t_t <- round(t.test(sbp ~ sex_fct, data=df.list[[i]])[[3]], 3)
if(t_t<0.001)t_t <- "<0.001"
build.df <- data.frame(
"Model"=mod.name,
"Men"=mean_men,
"Women"=mean_women,
"Diff_in_means"=diff,
"p-val"=t_t)
step.table <- rbind(step.table,build.df)
}
#Make table, then export as png, adding p values for differences in mean
step.table <- c()
model.names <- c("Before cleaning", "After dropping implausible values", "After dropping outliers")
sd.3 <- mean(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250])) + 3* sd(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250]))
df.list <- list(
steps_test_lec1,
filter(steps_test_lec1, sbp <250),
filter(steps_test_lec1, sbp < sd.3)
)
for (i in 1:length(model.names)){
mod.name <- model.names[i]
mean_men <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T), 1)})")
mean_women <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)})")
diff <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T) - mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)} ({round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[1]}, {round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[2]})")
t_t <- round(t.test(sbp ~ sex_fct, data=df.list[[i]])[[3]], 3)
if(t_t<0.001)t_t <- "<0.001"
build.df <- data.frame(
"Model"=mod.name,
"Men"=mean_men,
"Women"=mean_women,
"Diff_in_means"=diff,
"p-val"=t_t)
step.table <- rbind(step.table,build.df)
}
View(step.table)
knitr::opts_chunk$set(echo = TRUE)
if (!require("pacman")) install.packages("pacman")
pacman::p_load(gifski, ggplot2, rio, here, janitor, skimr, forcats, lubridate, tidyverse, gtsummary, rstatix, flextable, gt, webshot)
if(webshot::is_phantomjs_installed()==F)webshot::install_phantomjs()
steps_test_raw <- import(here("data", "STEPS_EpiInfo_Test.xlsx"))
skimr::skim(steps_test_raw)
steps_test <- steps_test_raw %>%
janitor::clean_names() %>%
# New name     # Old name
rename(sex          = c1,
age          = c3,
curr_smkr    = t1,
daily_smkr   = t2,
curr_alc     = a1,
freq_alc     = a2,
bp_last_meas = h1,
height_cm    = m3,
weight_kg    = m4,
sbp_1        = m11a,
sbp_2        = m12a,
sbp_3        = m13a) %>%
mutate(sbp = (sbp_1+sbp_2+sbp_3)/3, # Here I simply calculate the mean of the 3 sbp measurements
sex_fct = factor(sex, labels = c("Men", "Women"))) # Originally coded as 1 and 2
steps_test_lec1 <- steps_test %>%
select(c(sex_fct,sbp,sex)) %>%
drop_na() %>%
add_row(sbp = 540, sex_fct = as.factor("Women")) %>%
add_row(sbp = 538, sex_fct = as.factor("Women")) %>%
add_row(sbp = 542, sex_fct = as.factor("Women")) %>%
add_row(sbp = 540, sex_fct = as.factor("Women")) %>%
add_row(sbp = 538, sex_fct = as.factor("Women")) %>%
add_row(sbp = 542, sex_fct = as.factor("Women")) %>%
add_row(sbp = 540, sex_fct = as.factor("Women")) %>%
add_row(sbp = 538, sex_fct = as.factor("Women")) %>%
add_row(sbp = 542, sex_fct = as.factor("Women")) %>%
add_row(sbp = 540, sex_fct = as.factor("Women"))
#Make table, then export as png, adding p values for differences in mean
step.table <- c()
model.names <- c("Before cleaning", "After dropping implausible values", "After dropping outliers")
sd.3 <- mean(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250])) + 3* sd(na.omit(steps_test_lec1$sbp[steps_test_lec1$sbp<250]))
df.list <- list(
steps_test_lec1,
filter(steps_test_lec1, sbp <250),
filter(steps_test_lec1, sbp < sd.3)
)
for (i in 1:length(model.names)){
mod.name <- model.names[i]
mean_men <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T), 1)})")
mean_women <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T),1)} ({round(sd(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)})")
diff <- stringr::str_glue("{round(mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Men'],na.rm=T) - mean(df.list[[i]]$sbp[df.list[[i]]$sex_fct=='Women'],na.rm=T), 1)} ({round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[1]}, {round(t.test(sbp ~ sex_fct,data=df.list[[i]])[[4]],1)[2]})")
t_t <- round(t.test(sbp ~ sex_fct, data=df.list[[i]])[[3]], 3)
if(t_t<0.001)t_t <- "<0.001"
build.df <- data.frame(
"Model"=mod.name,
"Men"=mean_men,
"Women"=mean_women,
"Diff_in_means"=diff,
"p-val"=t_t)
step.table <- rbind(step.table,build.df)
}
step.table.1 <-
step.table[1,] %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-1.png")
step.table.2 <-
step.table[1:2,] %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-2.png")
step.table.3 <-
step.table %>%
flextable() %>%
autofit() %>%
add_header_row(
top=TRUE,
values=c("",
"Mean (SD)",
"",
"",
"")) %>%
set_header_labels(
Model = "",
Men = "Men",
Women = "Women",
Diff_in_means = "Difference in means (95% CI)",
p.val = "p-value") %>%
merge_at(i=1, j=2:3,part="header") %>%
flextable::align(align="center",j=c(2:3),part="header") %>%
bold(i=1,bold=TRUE,part="header") %>%
save_as_image(path = "figs/step-tbl-3.png")
knitr::opts_chunk$set(echo = FALSE)
pacman::p_load(devtools, gifski, ggplot2, tidyverse, rio, here)
devtools::install_github("hadley/emo")
pacman::p_load(devtools, gifski, ggplot2, tidyverse, rio, here, emo)
emojis_df<-emo::jis
View(emojis_df)
emo::ji("package")
